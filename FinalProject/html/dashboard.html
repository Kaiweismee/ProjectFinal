<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SmartSort AIï½œè³‡ç®¡æ¨“ç›£æ§ä¸­å¿ƒ</title>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

  <style>
    :root {
      --primary: #0bbf63;
      --warning: #f59e0b;
      --danger: #ef4444;
      --bg: #f1f5f9;
      --card-bg: #ffffff;
      --text-main: #1e293b;
      --text-sub: #64748b;
    }

    body { margin: 0; font-family: "Noto Sans TC", sans-serif; background: var(--bg); color: var(--text-main); height: 100vh; display: flex; flex-direction: column; }

    /* ä¸Šæ–¹å°è¦½åˆ— */
    .topbar { display: flex; justify-content: space-between; align-items: center; padding: 0 24px; height: 60px; background: var(--card-bg); border-bottom: 1px solid #e2e8f0; flex-shrink: 0; }
    .brand { font-size: 20px; font-weight: 700; color: var(--primary); display: flex; align-items: center; gap: 8px; }
    .nav-links a { margin-left: 8px; text-decoration: none; color: var(--text-sub); font-size: 14px; padding: 8px 16px; border-radius: 8px; }
    .nav-links .active { background: var(--primary); color: #ffffff; }

    /* ä¸»ç‰ˆé¢é…ç½® */
    .main-layout { 
      display: grid; 
      grid-template-columns: 2fr 1fr; 
      grid-template-rows: auto 1fr;
      gap: 20px; 
      padding: 24px; 
      height: calc(100vh - 60px); 
      box-sizing: border-box; 
      overflow: hidden; 
    }

    /* ä¸Šæ–¹ç‹€æ…‹çœ‹æ¿ */
    .dashboard-header {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .alert-card {
      background: white; border-radius: 12px; padding: 16px; border: 1px solid #e2e8f0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05); display: flex; flex-direction: column;
      max-height: 150px; overflow-y: auto;
    }
    .alert-card.critical { border-left: 5px solid var(--danger); background: #fef2f2; }
    .alert-card.warning { border-left: 5px solid var(--warning); background: #fffbeb; }

    .alert-title { font-size: 15px; font-weight: 700; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
    .critical .alert-title { color: var(--danger); }
    .warning .alert-title { color: #b45309; }

    .status-list { list-style: none; padding: 0; margin: 0; }
    .status-item {
      display: flex; justify-content: space-between; align-items: center;
      padding: 8px 10px; background: rgba(255,255,255,0.6);
      border-radius: 6px; margin-bottom: 6px;
      font-size: 14px; cursor: pointer; transition: 0.2s; border: 1px solid rgba(0,0,0,0.05);
    }
    .status-item:hover { background: white; transform: translateX(4px); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .empty-msg { font-size: 13px; color: #94a3b8; font-style: italic; padding: 5px; }

    /* å¡ç‰‡èˆ‡åœ–è¡¨ */
    .card { background: var(--card-bg); border-radius: 16px; padding: 24px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); display: flex; flex-direction: column; border: 1px solid #e2e8f0; overflow-y: hidden; }
    .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-shrink: 0; }
    .card-title { font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
    .chart-container { position: relative; flex-grow: 1; width: 100%; min-height: 0; }
    
    select { padding: 8px 12px; border-radius: 8px; border: 1px solid #cbd5e1; font-size: 14px; cursor: pointer; outline: none; }
    
    /* å³å´æ¨¡æ“¬å™¨ */
    .simulator-panel { background: #f8fafc; border-left: 4px solid var(--text-sub); overflow-y: auto; }
    .control-target-wrapper { background: #e2e8f0; padding: 10px; border-radius: 8px; margin-bottom: 20px; }
    .sim-row { margin-bottom: 15px; }
    .sim-label { display: flex; justify-content: space-between; font-size: 14px; margin-bottom: 6px; color: var(--text-sub); font-weight: 600; }
    input[type=range] { width: 100%; cursor: pointer; accent-color: var(--primary); }
    input[type=range].danger-level { accent-color: var(--danger); }

    .info-box { margin-top: 20px; padding: 15px; background: #e0f2fe; border-radius: 8px; font-size: 13px; color: #0369a1; line-height: 1.5; }

    @media (max-width: 768px) { 
      .main-layout { grid-template-columns: 1fr; grid-template-rows: auto auto 1fr auto; height: auto; overflow-y: auto; }
      .dashboard-header { grid-template-columns: 1fr; }
      .chart-container { min-height: 300px; }
    }
  </style>
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <span class="material-icons-round">recycling</span>
      SmartSort AI ç®¡ç†ç«¯ 
    </div>
    <nav class="nav-links">
      <a href="dashboard.html" class="active">å³æ™‚ç›£æ§</a>
      <a href="record.html">æ¸…é‹ç´€éŒ„</a>
      <a href="analytics.html">è³‡è¨Šå ±è¡¨</a>
    </nav>
  </header>

  <div class="main-layout">
    
    <div class="dashboard-header">
      <div class="alert-card critical">
        <div class="alert-title">
          <span class="material-icons-round">lock</span>
          å·²æ»¿ / å·²è‡ªå‹•é–è“‹ (>=95%)
        </div>
        <div id="criticalList" class="status-list">
          <div class="empty-msg">ç›®å‰ç„¡ç·Šæ€¥é …ç›®</div>
        </div>
      </div>
      <div class="alert-card warning">
        <div class="alert-title">
          <span class="material-icons-round">warning_amber</span>
          å³å°‡æ»¿æº¢ / éœ€å®‰æ’æ¸…é‹ (85%-94%)
        </div>
        <div id="warningList" class="status-list">
          <div class="empty-msg">ç›®å‰ç„¡é è­¦é …ç›®</div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <div class="card-title">
          <span class="material-icons-round" style="color:var(--primary)">analytics</span>
          å ´åŸŸè©³ç´°æ•¸æ“š
        </div>
        <select id="viewLocationSelect">
          <option value="im1R">è³‡ç®¡æ¨“ 1F å³å´</option>
          <option value="im1L">è³‡ç®¡æ¨“ 1F å·¦å´</option>
          <option value="im2F">è³‡ç®¡æ¨“ 2F</option>
          <option value="office">è³‡ç®¡æ¨“ ç³»è¾¦å…¬å®¤</option>
        </select>
      </div>

      <div class="chart-container">
        <canvas id="binChart"></canvas>
      </div>
    </div>

    <div class="card simulator-panel">
      <div class="card-header">
        <div class="card-title">
          <span class="material-icons-round">tune</span>
          Demo æ•¸æ“šæ¨¡æ“¬å™¨
        </div>
      </div>
      
      <div class="control-target-wrapper">
        <label style="font-size:12px; font-weight:bold; color:#64748b;">ğŸ‘‡ é¸æ“‡è¦æ¨¡æ“¬èª¿æ•´çš„å€åŸŸï¼š</label>
        <select id="controlLocationSelect" style="width:100%; margin-top:5px; font-weight:bold;">
          <option value="im1R">è³‡ç®¡æ¨“ 1F å³å´</option>
          <option value="im1L">è³‡ç®¡æ¨“ 1F å·¦å´</option>
          <option value="im2F">è³‡ç®¡æ¨“ 2F</option>
          <option value="office">è³‡ç®¡æ¨“ ç³»è¾¦å…¬å®¤</option>
        </select>
      </div>

      <p style="font-size:13px; color:#64748b; margin-bottom:15px;">
        æ‹‰å‹•æ»‘æ¡¿ï¼š<strong style="color:#f59e0b">85% (é è­¦)</strong> æˆ– <strong style="color:#ef4444">95% (é–è“‹)</strong>ã€‚
      </p>

      <div id="slidersContainer"></div>

    </div>
  </div>

  <script>
    /* è³‡æ–™çµæ§‹ - å·²æ›´æ–°ç‚ºè³‡ç®¡æ¨“ */
    const wasteTypes = ['å¡‘è† ', 'é‡‘å±¬', 'ç´™é¡', 'ç»ç’ƒ', 'ä¸€èˆ¬'];
    
    // é€™è£¡å°±æ˜¯å¾Œå°è³‡æ–™åº«çš„æ¨¡æ“¬
    let db = {
      im1R:   { name: "è³‡ç®¡æ¨“ 1F å³å´", data: [20, 20, 20, 10, 45] },
      im1L:   { name: "è³‡ç®¡æ¨“ 1F å·¦å´", data: [30, 25, 30, 15, 40] },
      im2F:   { name: "è³‡ç®¡æ¨“ 2F",      data: [15, 10, 50, 10, 30] },
      office: { name: "è³‡ç®¡æ¨“ ç³»è¾¦å…¬å®¤", data: [10, 5, 60, 5, 20] }
    };

    let viewingLoc = "im1R";   // é è¨­çœ‹ 1F å³å´
    let controllingLoc = "im1R"; 

    /* Chart.js åˆå§‹åŒ– */
    const ctx = document.getElementById("binChart").getContext('2d');
    let myChart = new Chart(ctx, {
      type: "bar",
      data: {
        labels: wasteTypes,
        datasets: [{
          label: "å®¹é‡ (%)",
          data: [],
          backgroundColor: [],
          borderRadius: 8,
          barPercentage: 0.6,
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        animation: { duration: 300 },
        scales: { y: { beginAtZero: true, max: 100 } },
        plugins: { legend: { display: false } }
      }
    });

    /* æ¸²æŸ“æ»‘æ¡¿ */
    const sliderContainer = document.getElementById("slidersContainer");
    function renderSliders() {
      sliderContainer.innerHTML = "";
      const currentData = db[controllingLoc].data;
      
      wasteTypes.forEach((type, index) => {
        const val = currentData[index];
        const isDanger = val >= 95;
        const color = getColor(val);
        
        const html = `
          <div class="sim-row">
            <div class="sim-label">
              <span>${type}</span>
              <span id="val-${index}" style="color:${color}">${val}%</span>
            </div>
            <input type="range" min="0" max="100" value="${val}" 
                   class="${isDanger ? 'danger-level' : ''}"
                   oninput="handleSliderChange(${index}, this.value)">
          </div>
        `;
        sliderContainer.insertAdjacentHTML('beforeend', html);
      });
    }

    function getColor(val) {
      if (val >= 95) return "#ef4444";
      if (val >= 85) return "#f59e0b";
      return "#0bbf63";
    }

    /* æ»‘æ¡¿è®Šå‹•é‚è¼¯ */
    function handleSliderChange(index, value) {
      const val = parseInt(value);
      db[controllingLoc].data[index] = val;

      // æ›´æ–°æ»‘æ¡¿æ•¸å€¼æ–‡å­—èˆ‡é¡è‰²
      const span = document.getElementById(`val-${index}`);
      if(span) {
        span.innerText = val + "%";
        span.style.color = getColor(val);
      }
      const slider = document.querySelector(`input[oninput="handleSliderChange(${index}, this.value)"]`);
      if(val >= 85) slider.classList.add('danger-level');
      else slider.classList.remove('danger-level');

      if (viewingLoc === controllingLoc) updateChart();
      updateDashboard();
    }

    function updateChart() {
      const data = db[viewingLoc].data;
      const colors = data.map(v => getColor(v));
      myChart.data.datasets[0].data = data;
      myChart.data.datasets[0].backgroundColor = colors;
      myChart.update();
    }

    /* å„€è¡¨æ¿æ›´æ–°é‚è¼¯ */
    function updateDashboard() {
      const criticalContainer = document.getElementById("criticalList");
      const warningContainer = document.getElementById("warningList");
      
      let criticalHTML = "";
      let warningHTML = "";
      let hasCritical = false;
      let hasWarning = false;

      for (const [locKey, locInfo] of Object.entries(db)) {
        locInfo.data.forEach((val, idx) => {
          const typeName = wasteTypes[idx];
          const itemHTML = `
            <div class="status-item" onclick="jumpToLocation('${locKey}')">
              <span><strong>${locInfo.name}</strong> - ${typeName}</span>
              <span style="font-weight:bold; color:${val>=95?'#ef4444':'#d97706'}">${val}%</span>
            </div>
          `;

          if (val >= 95) {
            criticalHTML += itemHTML;
            hasCritical = true;
          } else if (val >= 85) {
            warningHTML += itemHTML;
            hasWarning = true;
          }
        });
      }

      criticalContainer.innerHTML = hasCritical ? criticalHTML : '<div class="empty-msg">ç›®å‰ç„¡ç·Šæ€¥é …ç›®</div>';
      warningContainer.innerHTML = hasWarning ? warningHTML : '<div class="empty-msg">ç›®å‰ç„¡é è­¦é …ç›®</div>';
    }

    /* è·³è½‰ */
    function jumpToLocation(targetLocKey) {
      viewingLoc = targetLocKey;
      document.getElementById("viewLocationSelect").value = targetLocKey;
      updateChart();
      
      controllingLoc = targetLocKey;
      document.getElementById("controlLocationSelect").value = targetLocKey;
      renderSliders();
    }

    /* ç›£è½å™¨ */
    document.getElementById("viewLocationSelect").addEventListener("change", function() {
      viewingLoc = this.value;
      updateChart();
    });

    document.getElementById("controlLocationSelect").addEventListener("change", function() {
      controllingLoc = this.value;
      renderSliders();
    });

    // å•Ÿå‹•
    renderSliders();
    updateChart();
    updateDashboard();

  </script>
</body>
</html>