<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AI æ™ºæ…§åƒåœ¾åˆ†é¡ç³»çµ± - æ¸¬è©¦ç‰ˆ</title>
<link rel="stylesheet" href="../css/style.css">
<link rel="stylesheet" href="../css/trash.css">
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.16.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
<style>
  .user-badge {
  display: flex;
  align-items: center;
  background-color: white; /* ç¢ºä¿èƒŒæ™¯æ˜¯ç™½çš„ï¼Œå­—æ‰æ¸…æ¥š */
  padding: 5px 5px 5px 15px; /* å·¦é‚Šç•™å¤šä¸€é»ç©ºé–“çµ¦æ–‡å­— */
  border-radius: 50px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.08); /* åŠ ä¸Šä¸€é»é™°å½± */
  border: 1px solid #f1f5f9;
  gap: 10px;
}

/* é ­åƒ Icon */
.user-icon {
  color: #10B981; /* é…åˆä½ çš„ä¸»è‰²ç³» (ç¶ è‰²) */
  font-size: 24px;
}

/* ä½¿ç”¨è€…åç¨± */
.user-name {
  font-size: 15px;
  font-weight: 700;
  color: #334155;
  white-space: nowrap; /* é˜²æ­¢åå­—å¤ªé•·æ›è¡Œ */
}

/* ç™»å‡ºæŒ‰éˆ• (è®Šæˆä¸€å€‹åœ“å½¢å°æŒ‰éˆ•) */
.btn-logout-icon {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  border: none;
  background-color: #f1f5f9;
  color: #64748b;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s ease;
}

.btn-logout-icon span {
  font-size: 18px; /* icon å¤§å° */
}

/* æ»‘é¼ ç§»éå»ç™»å‡ºæŒ‰éˆ•çš„æ•ˆæœ */
.btn-logout-icon:hover {
  background-color: #fee2e2; /* æ·ºç´…è‰²èƒŒæ™¯ */
  color: #ef4444; /* ç´…è‰² icon */
  transform: rotate(90deg); /* å¢åŠ ä¸€é»äº’å‹•è¶£å‘³ */
}
body { font-family:"Noto Sans TC", sans-serif; background:#f4f7fb; color:#1f2937; margin:0; padding:0; }
header { text-align:center; padding:24px; background:linear-gradient(135deg,#2f9d62,#35c759); color:#fff; }
header h1 { font-size:28px; margin-bottom:6px; }
header p { font-size:14px; color:rgba(255,255,255,0.9); }
main { max-width:900px; margin:32px auto; padding:0 16px; display:grid; gap:24px; }

.card { background:#fff; border-radius:18px; padding:20px; box-shadow:0 10px 20px rgba(0,0,0,0.08); display:flex; flex-direction:column; align-items:center; }

#camera-area { position:relative; border-radius:20px; overflow:hidden; background:#111827; width:320px; height:240px; display:flex; align-items:center; justify-content:center; }
#camera-area video, #camera-area canvas { width:100%; height:100%; object-fit:cover; border-radius:12px; }

#preview-image { max-width:320px; max-height:240px; width:100%; height:auto; display:none; margin-top:12px; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,0.1); }

.button-group { display:flex; flex-wrap:wrap; gap:8px; justify-content:center; margin-top:12px; }

.btn { padding:10px 18px; border-radius:12px; border:none; font-weight:600; cursor:pointer; transition:all 0.2s ease; }
.btn-primary { background:#2f9d62; color:#fff; box-shadow:0 6px 12px rgba(47,157,98,0.3); }
.btn-primary:hover { transform:translateY(-2px); }
.btn-secondary { background:#e5e7eb; color:#374151; }
.btn-secondary:hover { transform:translateY(-2px); }
.btn:disabled { opacity:0.6; cursor:not-allowed; transform:none; box-shadow:none; }

.led-panel { display:grid; grid-template-columns:repeat(auto-fit,minmax(150px,1fr)); gap:16px; margin-top:16px; width:100%; }
.led { padding:16px; border-radius:16px; border:2px dashed #e5e7eb; text-align:center; color:#6b7280; font-weight:500; transition: all 0.2s ease; }
.led.active { border-color:#2f9d62; color:#2f9d62; background: rgba(47,157,98,0.08); box-shadow:0 10px 25px rgba(47,157,98,0.2); }

#result-display { margin-top:16px; text-align:center; }
#result-display h3 { margin:6px 0; font-size:22px; color:#2f9d62; }
#result-display small { color:#6b7280; }
</style>
</head>
<body>
  <header class="navbar">
    <div class="nav-left">
      <a href="../index.html"><div class="logo-dot"></div></a>
      <div>
        </a><div class="logo-title">SmartSort AI</div>
        <div class="logo-sub">AI SMART RECYCLING</div>
      </div>
    </div>
  
    <nav class="nav-links">
      <a href="../html/introduce.html">ç”¢å“ä»‹ç´¹</a>
      <a href="../html/guide.html">ç³»çµ±ä½¿ç”¨èªªæ˜</a>
      <a href="../html/reward.html">æœƒå“¡è³‡æ–™èˆ‡å›é¥‹</a>
    </nav>
  
    <div class="nav-auth">
      <a class="btn-login" href="/login">ç™»å…¥</a>
      <a class="btn-register" href="/register">è¨»å†Šå¸³è™Ÿ</a>
    </div>
  </header>
  <section class="hero">
    <div>
      <h1 class="hero-title">AIæ™ºæ…§åƒåœ¾å›æ”¶åˆ†é¡ç³»çµ±</h1>
      <p class="hero-sub">
        SmartSort AI çµåˆ AI å½±åƒè¾¨è­˜ã€IoT æ„Ÿæ¸¬èˆ‡äº’å‹•å¼æ•™è‚²ï¼Œå”åŠ©æå‡åƒåœ¾åˆ†é¡æº–ç¢ºç‡ã€é™ä½æ¸…é‹æˆæœ¬ï¼Œä¸¦å¼·åŒ–å¸‚æ°‘ç’°ä¿åƒèˆ‡ã€‚
      </p>
  
      <div class="hero-tags">
        <span>AI å½±åƒè¾¨è­˜</span>
        <span>IoT æ»¿ä½ç›£æ§</span>
        <span>äº’å‹•å¼æ•™å­¸</span>
        <span>å›é¥‹çå‹µæ©Ÿåˆ¶</span>
      </div>
  
  
        
    </div>
  </section>
<main>
<div class="card">
  <h2>ğŸ–¥ï¸ å³æ™‚æ”å½±æ©Ÿ / ä¸Šå‚³åœ–ç‰‡æ¸¬è©¦</h2>

  <div id="camera-area">
    <video id="camera" autoplay playsinline></video>
  </div>

  <img id="preview-image" />

  <input type="file" id="upload-image" accept="image/*">

  <div class="button-group">
    <button class="btn btn-primary" id="btn-reset-upload" disabled>é‡æ–°è¾¨è­˜</button>
    <button class="btn btn-primary" id="btn-start">å•Ÿç”¨æ”å½±æ©Ÿ</button>
    <button class="btn btn-secondary" id="btn-stop" disabled>åœæ­¢æ”å½±æ©Ÿ</button>
  </div>

  <small id="model-status" style="margin-top:8px; color:#6b7280;">æ¨¡å‹è¼‰å…¥ä¸­â€¦</small>

  <div id="result-display">
    <p style="font-size:13px;">æœ€æ–°è¾¨è­˜çµæœ</p>
    <h3 id="detected-label">å°šæœªè¾¨è­˜</h3>
    <small id="confidence">ä¿¡å¿ƒå€¼ -</small>
  </div>

  <div class="bar-panel">
    <div class="bar-container"><div class="bar-fill bar-plastic">0%</div><span class="bar-label">Plastic / å¡‘è† </span></div>
    <div class="bar-container"><div class="bar-fill bar-paper">0%</div><span class="bar-label">Paper / ç´™é¡</span></div>
    <div class="bar-container"><div class="bar-fill bar-metal">0%</div><span class="bar-label">Metal / é‡‘å±¬</span></div>
    <div class="bar-container"><div class="bar-fill bar-glass">0%</div><span class="bar-label">Glass / ç»ç’ƒ</span></div>
    <div class="bar-container"><div class="bar-fill bar-trash">0%</div><span class="bar-label">Trash / ä¸€èˆ¬åƒåœ¾</span></div>
    <div class="bar-container"><div class="bar-fill bar-cardboard">0%</div><span class="bar-label">Cardboard / ç´™æ¿</span></div>
  </div>
  </div>
</div>

</main>
<script src="script.js"></script>
<script>
const MODEL_FOLDER = "./tm-my-image-model/";
const MODEL_URL = MODEL_FOLDER + "model.json";
const METADATA_URL = MODEL_FOLDER + "metadata.json";

const camera = document.getElementById("camera");
const btnStart = document.getElementById("btn-start");
const btnStop = document.getElementById("btn-stop");
const modelStatusEl = document.getElementById("model-status");
const detectedLabel = document.getElementById("detected-label");
const confidenceText = document.getElementById("confidence");
const uploadImage = document.getElementById("upload-image");
const previewImage = document.getElementById("preview-image");
const btnResetUpload = document.getElementById("btn-reset-upload");
const binPanel = document.getElementById("bin-panel");
let binLEDs = document.querySelectorAll("#bin-panel .led");

let tmModel = null;
let modelReady = false;
let mediaStream = null;
let autoDetectInterval = null;
let uploadedImg = null;

async function loadModel() {
  modelStatusEl.textContent = "æ¨¡å‹è¼‰å…¥ä¸­â€¦";
  tmModel = await tmImage.load(MODEL_URL, METADATA_URL);
  modelReady = true;
  modelStatusEl.textContent = "æ¨¡å‹è¼‰å…¥å®Œæˆï¼Œè«‹å•Ÿç”¨æ”å½±æ©Ÿæˆ–ä¸Šå‚³åœ–ç‰‡";
}

async function predictImage(imgElement){
  if(!modelReady) return;
  const predictions = await tmModel.predict(imgElement);
  predictions.sort((a,b)=>b.probability-a.probability);
  const top = predictions[0];

  detectedLabel.textContent = top.className;
  confidenceText.textContent = `ä¿¡å¿ƒå€¼ ${(top.probability*100).toFixed(1)}%`;

  binLEDs.forEach(led => led.classList.toggle("active", led.dataset.bin === top.className));
}

// æ”å½±æ©Ÿ
async function startCamera(){
  mediaStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
  camera.srcObject = mediaStream;
  btnStart.disabled = true;
  btnStop.disabled = false;

  autoDetectInterval = setInterval(async () => {
    if(modelReady) await predictImage(camera);
  }, 500);
}
function stopCamera(){
  if(mediaStream) mediaStream.getTracks().forEach(t => t.stop());
  camera.srcObject = null;
  btnStart.disabled = false;
  btnStop.disabled = true;
  if(autoDetectInterval) clearInterval(autoDetectInterval);
}

// ä¸Šå‚³åœ–ç‰‡è‡ªå‹•è¾¨è­˜
uploadImage.addEventListener("change", (e)=>{
  const file = e.target.files[0];
  if(!file) return;

  uploadedImg = new Image();
  uploadedImg.src = URL.createObjectURL(file);
  previewImage.src = uploadedImg.src;
  previewImage.style.display = "block";

  btnResetUpload.disabled = false;

  uploadedImg.onload = async ()=>{
    if(modelReady){
      await predictImage(uploadedImg);
    }
  }
});

// é‡æ–°è¾¨è­˜
btnResetUpload.addEventListener("click", ()=>{
  uploadedImg = null;
  previewImage.src = "";
  previewImage.style.display = "none";
  uploadImage.value = "";
  detectedLabel.textContent = "å°šæœªè¾¨è­˜";
  confidenceText.textContent = "ä¿¡å¿ƒå€¼ -";
  binLEDs.forEach(led => led.classList.remove("active"));
  btnResetUpload.disabled = true;
});

btnStart.addEventListener("click", startCamera);
btnStop.addEventListener("click", stopCamera);
window.addEventListener("load", loadModel);
</script>
</body>

<script>
  window.addEventListener("scroll", function () {
    const navbar = document.querySelector(".navbar");
    if (window.scrollY > 50) {
      navbar.classList.add("scrolled");
    } else {
      navbar.classList.remove("scrolled");
    }
  });
  </script>
  <footer class="footer">
    <p>Â© 2025 SmartSort AI ãƒ» ä¸­åŸå¤§å­¸è³‡è¨Šç®¡ç†å­¸ç³»</p>
  </footer>
  <script>
    // 1. å°è¦½åˆ—æ»¾å‹•æ•ˆæœ
    window.addEventListener("scroll", function () {
      const navbar = document.querySelector(".navbar");
      if (window.scrollY > 50) {
        navbar.classList.add("scrolled");
        // é€™è£¡å»ºè­°è£œä¸Š CSS: .scrolled { box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
      } else {
        navbar.classList.remove("scrolled");
      }
    });

    // 2. ç™»å…¥ç‹€æ…‹æª¢æŸ¥
    document.addEventListener("DOMContentLoaded", function() {
        // è®€å–ç™»å…¥è³‡è¨Š
        const userJson = localStorage.getItem("currentUser");
        const navAuthBlock = document.querySelector(".nav-auth");

        // åœ¨ index.html çš„ script è£¡é¢æ‰¾åˆ°é€™æ®µ
if (userJson) {
    const user = JSON.parse(userJson);
    
    // æ”¹æˆé€™å€‹æ–°çš„ HTML çµæ§‹
    navAuthBlock.innerHTML = `
        <div class="user-badge">
            <span class="material-icons-round user-icon">face</span>
            <span class="user-name">${user.name}</span>
            <button onclick="logout()" class="btn-logout-icon" title="ç™»å‡º">
                <span class="material-icons-round">logout</span>
            </button>
        </div>
    `;
    
    console.log("å·²ç™»å…¥ï¼š" + user.name);
}
    });

    // 3. ç™»å‡ºåŠŸèƒ½
    function logout() {
        if(confirm("ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ")) {
            localStorage.removeItem("currentUser"); // ç§»é™¤ç™»å…¥ç‹€æ…‹
            alert("å·²ç™»å‡º");
            window.location.reload(); // é‡æ–°æ•´ç†é é¢ï¼Œæ¢å¾©æˆç™»å…¥/è¨»å†ŠæŒ‰éˆ•
        }
    }
</script>
</html>
